import sqlite3 as sql
import time
import tkinter
window=tkinter.Tk()
CounterButton=tkinter.Button(padx=320,pady=240)
conn=sql.connect("../coredata.db")
c=conn.cursor()

def Alarmconfirmed(MainButton):
    
    x=time.mktime(time.localtime())
    y=[x,x]
    c.execute('update alarms set approved=? where timer<? and approved is null',y)
    conn.commit()
    MainButton.config(command=SwitchGUI(window, MainButton))
    MainButton.config(background="white")
def AlarmplusHours(Hours):
    c.execute('select timer from alarms where approved is null order by timer asc')
    alarms=c.fetchall()
    for i in alarms:
        seconds=Hours*3600
        x=i[0]
        y=x+seconds
        c.execute('update alarms set timer=? where timer=?',y,x)
        conn.commit()
def SwitchGUI(window, OldButton):
    NewButton=OldButton.copy()
    OldButton.destroy()
    AlarmNow=tkinter.Button(window,pady=80, padx=160, text="Alarm auslösen", background="red")
    AlarmPlusAnHour=tkinter.Button(window,pady=80,padx=160,text="Alarm 1 Stunde verschieben", command=AlarmplusHours(1))
    Alarmplus1day=tkinter.Button(window,pady=80,padx=160,text="Alarm 1 Tag verschieben", command=AlarmplusHours(24))
    NextAlarm=tkinter.Label(window,pady=240, padx=160)
    def newalarm(label):
        
            def loop():
                c.execute('select timer from alarms where approved is null order by timer asc')
                x=time.ctime(c.fetchall[0][0])
                label.configure(text=x)
                label.after(1000, loop)
            loop()
    NextAlarm.grid(column=0,rowspan=3,row=0)
    newalarm(NextAlarm)
    Alarmplus1day.grid(column=1,row=0)
    AlarmPlusAnHour.grid(column=1,row=1)
    AlarmNow.grid(column=1,row=2)
    window.mainloop()
    time.sleep(60)
    NextAlarm.destroy()
    Alarmplus1day.destroy()
    AlarmPlusAnHour.destroy()
    AlarmNow.destroy()
    NewButton.pack()
    window.mainloop
def counter_label(label):
        c.execute('select timer from alarms where approved is null order by timer asc' )
        x=c.fetchall()[0][0]
        print(x)
                  
        q=list(time.localtime(x))

        gg=str(q[3])+":"+str(q[4])
        
        def count():
            
            y=time.mktime(time.localtime())
            z=time.gmtime(x-y)
            label.config(text=gg+"\n"+str(z[3])+":"+str(z[4])+":"+str(z[5]))
            label.after(1000, count)
            
        count()
def alarm(window, MainButton):
    
    
    MainButton.config(background="green", command=Alarmconfirmed(MainButton))
   
    
    
    
    
    